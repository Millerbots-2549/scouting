<!DOCTYPE html>
<html lang="en">
<head>
    <title>Scouting Results</title>
    <meta charset="utf-8" content="width=device-width, initial-scale=1" name="viewport"/>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/millerbots.css" rel="stylesheet" type="text/css"/>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/popper.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>

<div class="jumbotron text-center">
    <div class="container">
        <img alt="" id="millerbots-logo" src="images/miller_bots.jpg"/>
        <h1>Washburn Millerbots Scouting System</h1>
        <p>Team 2549</p>
    </div>
    <nav class="navbar navbar-expand-sm bg-light navbar-light">
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="scouting.html">Scouting</a></li>
        </ul>
    </nav>
    <p></p>
</div>

<div class="container-fluid">

    <p></p>
    <div class="row">
        <div class="col-md-3">
            <label for="team_number">Team Number:</label>
            <input autofocus id="team_number" maxlength="5" name="teamNumber" size="5" type="number"/>
        </div>
        <div class="col-md-2">
            <button class="btn" id="teamFindBtn" type="button">Find</button>
        </div>
        <div class="col-md-5">
            <div id="team_name"></div>
        </div>
    </div>
    <p></p>

    <div id="resultsDiv"></div>

</div>

<script type="text/javascript">


    $('#teamFindBtn').on('click', function () {
        var teamId = $('#team_number').val();
        $.ajax({
            dataType: "json",
            url: "results/" + teamId,
            cache: false,
            success: function (json) {
                buildTeamData(json);
                var surveyObjs = json.surveys;
                var allSurveyData = '';
                for (i in surveyObjs) {
                    var survey = surveyObjs[i];
                    allSurveyData += buildSurveySection(survey)
                }
                $('#resultsDiv').html(allSurveyData);
            },

            error: function (response) {
                console.log(response)
            }
        });
    });

    function buildTeamData(json) {
        var teamData = '';
        teamData += '<h5>' + json.teamName + '</h5>';
        $('#team_name').html(teamData);
    }

    function buildSurveySection(survey) {
        var surveyHtml = '';
        surveyHtml += '<hr><h2>' + survey.surveyName + '</h2><table id="surveyResults' + survey.surveyId + '" class="table-responsive table-bordered">';
        surveyHtml += buildTableHeader(survey.questions);
        surveyHtml += buildTableBody(survey.questions);
        surveyHtml += '</table>';
        return surveyHtml
    }

    function buildTableHeader(questions) {
        var surveyHtml = '<thead>';
        surveyHtml += buildHeaderRow(questions[0]);
        surveyHtml += '</thead>';
        return surveyHtml;
    }

    function buildTableBody(questions) {
        var surveyHtml = '<tbody>';
        surveyHtml += buildStudentNameRow(questions[0]);
        for (i in questions) {
            surveyHtml += buildRow(questions[i])
        }
        surveyHtml += '</tbody>';
        return surveyHtml;
    }

    function buildHeaderRow(question) {
        var responses = question.responses;
        var rowHtml = '<tr>';
        rowHtml += '<th>Question</th>';
        for (i in responses) {
            rowHtml += '<th>Match ' + responses[i].matchup + '</th>';
        }
        rowHtml += '<th>Summary</th>';
        rowHtml += '</tr>';
        return rowHtml;
    }

    function buildStudentNameRow(question) {
        var responses = question.responses;
        var rowHtml = '<tr>';
        rowHtml += '<td><I>Student</I></td>';
        for (i in responses) {
            rowHtml += '<td><I>' + responses[i].studentName + '</I></td>';
        }
        rowHtml += '<td></td>';
        rowHtml += '</tr>';
        return rowHtml;
    }

    function buildRow(question) {
        var responses = question.responses;
        var rowHtml = '<tr>';
        rowHtml += '<td>' + question.question + '</td>';
        for (i in responses) {
            rowHtml += '<td>' + responses[i].response + '</td>';
        }
        rowHtml += '<td>' + question.summary + '</td>';
        rowHtml += '</tr>';
        return rowHtml;
    }

</script>

</body>
</html>
